<?xml version="1.0"?>
<!-- robot_arm.xacro -->
<robot name="robot_arm" xmlns:xacro="http://ros.org/wiki/xacro">
  <xacro:include filename="robot_arm_macros.xacro"/>
  <xacro:include filename="gripper.xacro"/>

  <!-- ====== WORLD LINK ====== -->
  <link name="world"/>

  <!-- ====== FIX ROBOT TO WORLD ====== -->
  <xacro:cobot_joint 
    name="world_base_link" 
    type="fixed" 
    parent="world" 
    child="base_link" 
    axis="0 0 0" 
    limit_l="0" 
    limit_u="0" 
    limit_v="0" 
    limit_e="0"
    origin_xyz="0 0 0" 
    origin_rpy="0 0 0"/>

  <!-- ====== ARM LINKS ====== -->
  
  <!-- Base link -->
  <xacro:link_cylinder 
    name="base_link" 
    xyz="0 0 0.025" 
    rpy="0 0 0" 
    radius="0.1" 
    length="0.05" 
    mass="1.0"
    ixx="0.00270833" 
    iyy="0.00270833" 
    izz="0.005"/>

  <!-- Link 1 -->
  <xacro:link_cylinder 
    name="link1" 
    xyz="0 0 0.132" 
    rpy="0 0 0" 
    radius="0.05" 
    length="0.264" 
    mass="0.6"
    ixx="0.005808" 
    iyy="0.005808" 
    izz="0.00075"/>

  <!-- Link 2 -->
  <xacro:link_cylinder 
    name="link2" 
    xyz="0 0 0.425" 
    rpy="0 0 0" 
    radius="0.05" 
    length="0.850" 
    mass="0.7"
    ixx="0.042583" 
    iyy="0.042583" 
    izz="0.000875"/>

  <!-- Link 3 (commented - uncomment when ready) -->
  <xacro:link_cylinder 
    name="link3" 
    xyz="0 0 0.340" 
    rpy="0 0 0" 
    radius="0.05" 
    length="0.680" 
    mass="0.8"
    ixx="0.038293" 
    iyy="0.038293" 
    izz="0.001"/>

  <!-- Link 4 (commented - uncomment when ready) -->
  <xacro:link_cylinder 
    name="link4" 
    xyz="0 0 0.065" 
    rpy="0 0 0" 
    radius="0.05" 
    length="0.130" 
    mass="0.5"
    ixx="0.003646" 
    iyy="0.003646" 
    izz="0.000625"/>

  <!-- Link 5 (commented - uncomment when ready) -->
  <xacro:link_cylinder 
    name="link5" 
    xyz="0 0 0.035" 
    rpy="0 0 0" 
    radius="0.05" 
    length="0.170" 
    mass="0.3"
    ixx="0.00225" 
    iyy="0.00225" 
    izz="0.000375"/>

  <!-- Gripper (commented - uncomment when ready with link5) -->
  <xacro:gripper_connector_link/>

  <xacro:gripper_right_finger_link/>
  
  <xacro:gripper_left_finger_link/>


  <!-- ====== ARM JOINTS ====== -->

  <!-- Joint: base_link to link1 -->
  <xacro:cobot_joint 
    name="base_link_link1" 
    type="revolute" 
    parent="base_link" 
    child="link1" 
    axis="0 0 1"
    limit_l="-3.14159" 
    limit_u="3.14159" 
    limit_v="0.5" 
    limit_e="1000.0"
    origin_xyz="0 0 0.05" 
    origin_rpy="0 0 0"/>

  <!-- Joint: link1 to link2 -->
  <xacro:cobot_joint 
    name="link1_link2" 
    type="revolute" 
    parent="link1" 
    child="link2" 
    axis="1 0 0"
    limit_l="-2.5" 
    limit_u="2.5" 
    limit_v="0.5" 
    limit_e="1000.0"
    origin_xyz="0.1 0 0.264" 
    origin_rpy="0 0 0"/>

  <!-- Joint: link2 to link3 (commented - uncomment when ready) -->
  <xacro:cobot_joint 
    name="link2_link3" 
    type="revolute" 
    parent="link2" 
    child="link3" 
    axis="1 0 0"
    limit_l="-3.14" 
    limit_u="3.14" 
    limit_v="0.5" 
    limit_e="1000.0"
    origin_xyz="-0.1 0 0.850" 
    origin_rpy="0 0 0"/>

  <!-- Joint: link3 to link4 (commented - uncomment when ready) -->
  <xacro:cobot_joint 
    name="link3_link4" 
    type="revolute" 
    parent="link3" 
    child="link4" 
    axis="1 0 0"
    limit_l="-3.14" 
    limit_u="3.14" 
    limit_v="0.5" 
    limit_e="1000.0"
    origin_xyz="0.1 0 0.680" 
    origin_rpy="0 0 0"/>

  <!-- Joint: link4 to link5 (commented - uncomment when ready) -->
  <xacro:cobot_joint 
    name="link4_link5" 
    type="revolute" 
    parent="link4" 
    child="link5" 
    axis="0 1 0"
    limit_l="-3.14" 
    limit_u="3.14" 
    limit_v="0.5" 
    limit_e="1000.0"
    origin_xyz="0 0 0.180" 
    origin_rpy="1.57 0 0"/>

  <xacro:gripper_connector_joint parent="link5" origin_xyz="0 0 0.135"/>

  <xacro:gripper_right_finger_joint />

  <xacro:gripper_left_finger_joint />




  <!-- ====== ROS2_CONTROL CONFIGURATION ====== -->
  <ros2_control name="RobotController" type="system">
    <hardware>
      <plugin>gz_ros2_control/GazeboSimSystem</plugin>
    </hardware>

    <!-- Active arm joints -->
    <joint name="base_link_link1">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="link1_link2">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <!-- Additional joints (uncomment when ready) -->
    <joint name="link2_link3">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="link3_link4">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="link4_link5">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="gripper_connector_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="gripper_right_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

    <joint name="gripper_left_joint">
      <command_interface name="position"/>
      <state_interface name="position"/>
      <state_interface name="velocity"/>
    </joint>

  </ros2_control>

  <!-- ====== GAZEBO PLUGIN ====== -->
  <gazebo>
    <plugin name="gz_ros2_control::GazeboSimROS2ControlPlugin" filename="libgz_ros2_control-system.so">
      <parameters>$(find robot_arm)/config/controller.yaml</parameters>
      <controller_manager_name>controller_manager</controller_manager_name>
    </plugin>
  </gazebo>



</robot>
